{% extends "base.html" %}

{% block title %}Update Results – Round {{ round.round_number }}{% endblock %}

{% block content %}
<div class="container">
  <h1 class="my-4 text-center">Update Results – Round {{ round.round_number }}</h1>

  <div class="card bg-light border-primary mb-4">
    <div class="card-body">
      <h5 class="card-title">Simplified Workflow</h5>
      <p class="card-text">Click this button to automatically fetch the latest results from the API and immediately process all eliminations for this round.</p>
      <form method="post" action="{{ url_for('admin_auto_update_and_process_round', round_id=round.id) }}" class="d-grid">
        <button type="submit" class="btn btn-primary btn-lg">Auto-Update & Process Round</button>
      </form>
    </div>
  </div>

  <hr>

  <h4 class="mt-4">Manual Control</h4>
  <p>Or, use the manual controls below.</p>

  <form method="post" action="{{ url_for('admin_auto_update_results', round_id=round.id) }}" class="mb-3">
    <button type="submit" class="btn btn-secondary">1. Auto-update from API</button>
  </form>

  <div class="d-flex gap-2 mb-3">
    <a href="{{ url_for('admin_process_round', round_id=round.id) }}" class="btn btn-warning">2. Process Eliminations</a>
  </div>

  <form method="post">
    <div class="table-responsive mb-3">
      <table class="table table-striped table-bordered table-hover">
        <thead>
          <tr>
            <th>Date/Time</th>
            <th>Fixture</th>
            <th>Home Score</th>
            <th>Away Score</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          {% for f in fixtures %}
          <tr>
            <td>{{ f.date.strftime('%Y-%m-%d %H:%M') if f.date else '' }}</td>
            <td>{{ f.home_team }} vs {{ f.away_team }}</td>
            <td>
              <input type="hidden" name="fixture_id" value="{{ f.id }}">
              <input type="number" name="home_score" value="{{ f.home_score if f.home_score is not none }}" class="form-control form-control-sm" style="width: 6em;">
            </td>
            <td>
              <input type="number" name="away_score" value="{{ f.away_score if f.away_score is not none }}" class="form-control form-control-sm" style="width: 6em;">
            </td>
            <td>
              <select name="status" class="form-select form-select-sm">
                {% set opts = ['scheduled','completed','FT','AET','PEN','postponed','cancelled'] %}
                {% for s in opts %}
                  <option value="{{ s }}" {% if f.status==s %}selected{% endif %}>{{ s }}</option>
                {% endfor %}
              </select>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <button type="submit" class="btn btn-secondary mb-3">Save Manual Changes</button>
  </form>

  <div class="d-flex gap-2">
    <a href="{{ url_for('admin_round_summary', round_id=round.id) }}" class="btn btn-info">Round Summary</a>
    <a href="{{ url_for('admin_dashboard') }}" class="btn btn-secondary">Back to Admin</a>
  </div>
</div>
{% endblock %}